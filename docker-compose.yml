version: '3.8'

services:
  terraform:
    build: .
    container_name: azure-terraform
    volumes:
      # Mount the entire project directory
      - .:/workspace
      # Persist Terraform state and plugins
      - terraform-plugins:/root/.terraform.d/plugins
      - terraform-cache:/workspace/terraform/.terraform
    environment:
      # Azure authentication - set these before running
      - ARM_CLIENT_ID=${ARM_CLIENT_ID}
      - ARM_CLIENT_SECRET=${ARM_CLIENT_SECRET}
      - ARM_SUBSCRIPTION_ID=${ARM_SUBSCRIPTION_ID}
      - ARM_TENANT_ID=${ARM_TENANT_ID}
      # Or use Azure CLI authentication
      - AZURE_CONFIG_DIR=/workspace/.azure
    working_dir: /workspace
    stdin_open: true
    tty: true

volumes:
  terraform-plugins:
  terraform-cache:
